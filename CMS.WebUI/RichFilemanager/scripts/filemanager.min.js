(function(n){function a(i,r){return y.indexOf(r)===-1?!1:i["File Type"]=="dir"&&r=="replace"?!1:i["File Type"]=="dir"&&r=="select"?!1:i["File Type"]=="dir"&&r=="download"?t.security.allowFolderDownload===!0:typeof i.Capabilities!="undefined"?n.inArray(r,i.Capabilities)>-1:!0}function li(r){var u={select:{name:i.select,className:"select"},download:{name:i.download,className:"download"},rename:{name:i.rename,className:"rename"},move:{name:i.move,className:"move"},replace:{name:i.replace,className:"replace"},separator1:"-----","delete":{name:i.del,className:"delete"}},f=r.data("itemdata");return a(f,"download")||delete u.download,a(f,"rename")&&t.options.browseOnly!==!0||delete u.rename,a(f,"delete")&&t.options.browseOnly!==!0||delete u.delete,a(f,"move")&&t.options.browseOnly!==!0||delete u.move,a(f,"select")&&(window.opener||window.tinyMCEPopup||n.urlParam("field_name"))||delete u.select,delete u.replace,u}var bi,ni,i,gr,nu,uf;n.urlParam=function(n){var t=new RegExp("[\\?&]"+n+"=([^&#]*)").exec(window.location.href);return t?t[1]:0};var tu=function(n){var e="",t="/",u=".",h=u.concat(u),o,i,f,s,r;if(!n||n===t)return t;for(o=n.split(t),i=n[0]===t||n[0]===u?[e]:[],f=0,s=o.length;f<s;++f)r=o[f]||e,r===h?i.length>1&&i.pop():r!==e&&r!==u&&i.push(r);return i.join(t).replace(/[\/]{2,}/g,t)||t},wi=function(t){var i=null,u=".",f,r;return t=typeof t=="undefined"?"user":t,window._FMConfig&&window._FMConfig.pluginPath&&(u=window._FMConfig.pluginPath),f="/RichFilemanager/default.aspx/GetSetting",r="",t=="user"?n.urlParam("config")!=0?(r=u+"/scripts/"+n.urlParam("config"),userconfig=n.urlParam("config")):(r=f,userconfig=f):r=u+"/scripts/filemanager.config.default.json",n.ajax({async:!1,url:r,type:t==="user"?"post":"get",dataType:"json",data:'{"key":"'+n.urlParam("key")+'","fm":"'+n.urlParam("fm")+'"}',contentType:"application/json;charset=utf-8;",cache:!1,success:function(n){if(n.d)try{i=JSON.parse(n.d)}catch(t){i=n.d}else i=n},error:function(){}}),t=="default"&&(i.globals={pluginPath:u}),i},iu=wi("default"),t=wi();t!==null&&delete t.version;t=n.extend({},iu,t);t.options.logger&&(bi=(new Date).getTime());var st=[],s="/",p,ki="/connectors/"+t.options.lang+"/filemanager."+t.options.lang,f=t.options.fileConnector||t.globals.pluginPath+ki,y=t.options.capabilities||["upload","select","download","rename","move","delete","replace"],nt=null,ft={},kt=[];t.options.fileSorting&&(kt=t.options.fileSorting.toLowerCase().split("_"));var di=kt[0]||"name",dt=kt[1]||"asc",et=function(i){if(i=t.globals.pluginPath+i,n.inArray(i,st)==-1){var r=n("<link rel='stylesheet' type='text/css' href='"+i+"'>");n("head").append(r);st.push(i)}},w=function(i){if(i=t.globals.pluginPath+i,n.inArray(i,st)==-1){var r=n("<script type='text/javascript' src='"+i+"'>");n("head").append(r);st.push(i)}},gi=function(i,r){var u;return n.ajax({url:t.globals.pluginPath+"/scripts/templates/"+i+".html",async:!1,success:function(n){u=tmpl(n,r)}}),u},nr=function(n){var t=this.window.ActiveXObject?new ActiveXObject("Microsoft.XMLHTTP"):new XMLHttpRequest;if(!t)throw new Error("XMLHttpRequest not supported");return t.open("HEAD",n,!1),t.send(null),t.status==200},r=n("#fileinfo"),u=n("#filetree"),gt=n("#uploader"),h=n("#upload");n.urlParam("langCode")!=0&&(nr(t.globals.pluginPath+"/scripts/languages/"+n.urlParam("langCode")+".json")?t.options.culture=n.urlParam("langCode"):(ni=n.urlParam("langCode").substring(0,2),nr(t.globals.pluginPath+"/scripts/languages/"+ni+".json")&&(t.options.culture=ni)));i=[];n.ajax({url:t.globals.pluginPath+"/scripts/languages/"+t.options.culture+".json",async:!1,dataType:"json",success:function(n){i=n}});n.prompt.setDefaults({overlayspeed:"0",promptspeed:0,show:"fadeIn",opacity:.4,persistent:!1,classes:{box:"fm-modal-container",fade:"",prompt:"",close:"",title:"",message:"",buttons:"",button:"",defaultButton:""}});var ht=function(){var o=0,i=n(".fm-container"),s=n("#splitter, #filetree, #fileinfo, .vsplitbar"),c=i.outerHeight(!0)-i.height(),t,f,e,h;n.urlParam("CKEditorCleanUpFuncNum")&&(o+=60);t=n(window).height()-gt.height()-n("#footer").height()-c-o;s.height(t);f=n(document).height()-n(window).height();!i.parent().is("body")&&f>0&&(e=t-f,t=e>0?e:1,s.height(t));h=n("#splitter").width()-n("div.vsplitbar").width()-u.width();r.width(h)},tr=function(n){setTimeout(function(){n.mCustomScrollbar("update")},100)},ir=function(n,i){if(i=typeof i=="undefined",t.options.showFullPath===!1){if(n=n.replace(s,"/"),"function"==typeof displayPathDecorator)return displayPathDecorator(n);if(n.length>50&&i===!0){var r=n.split("/");n="/"+r[1]+"/"+r[2]+"/(...)/"+r[r.length-2]+"/"}return n}return n},ti=function(t){t=="grid"?(n("#grid").addClass("ON"),n("#list").removeClass("ON")):(n("#list").addClass("ON"),n("#grid").removeClass("ON"))},ii=function(n,i){if(t.security.normalizeFilename){var r={" ":"-","'":"-","/":"","\\":""};n=n.replace(/[\s\S]/g,function(n){return r[n]||n})}return t.options.charsLatinOnly&&(w("/scripts/speakingurl/speakingurl.min.js"),typeof i=="undefined"&&(i=[]),n=getSlug(n,{separator:"_",maintainCase:!0,custom:i}),n=n.replace(/[^-a-zA-Z0-9]/g,"")),n.replace(/[-]+/g,"-")},ru=function(n){return n.lastIndexOf(".")!=-1?ii(n.substr(0,n.lastIndexOf(".")))+("."+n.split(".").pop()):ii(n)},b=function(n,t){t=t||!1;for(var r=parseFloat(n),u=parseFloat(t?1e3:1024),f=0,e=[i.bytes,i.kb,i.mb,i.gb];;){if(r<u)return r=Math.round(r*100)/100,r+" "+e[f];r/=u;f+=1}},ct=function(t){r.html("<h1>"+t+"<\/h1>");n("#newfile").prop("disabled",!0);n("#newfolder").prop("disabled",!0);h.prop("disabled",!0)},it=function(){n.prompt(i.ERROR_SERVER)};var uu=function(i){var r=e(i);return r==""&&t.security.allowNoExtension==!0?!0:t.security.uploadPolicy=="DISALLOW_ALL"&&n.inArray(r,t.security.uploadRestrictions)!=-1?!0:t.security.uploadPolicy=="ALLOW_ALL"&&n.inArray(r,t.security.uploadRestrictions)==-1?!0:!1},v=function(n){return n.charAt(n.length-1)!="/"},rr=function(n){return n.replace(/^\/+|\/+$/g,"")},ur=function(n,t){var i=n.replace(/^.*[\/\\]/g,"");return typeof t=="string"&&i.substr(i.length-t.length)==t&&(i=i.substr(0,i.length-t.length)),i},e=function(n){return n.split(".").length==1?"":n.split(".").pop().toLowerCase()},fu=function(n){return n.lastIndexOf(".")!=-1?n.substring(0,n.lastIndexOf(".")):n},tt=function(n){return n.lastIndexOf("/")!=n.length-1?n.substr(0,n.lastIndexOf("/")+1):n},c=function(){var t=0;return t=typeof forcePath!="undefined"&&forcePath.length>0?forcePath:n.urlParam("exclusiveFolder")||n.urlParam("exclusivefolder"),t!==0&&t.charAt(t.length-1)!="/"&&(t+="/"),t},lt=function(n){var t=n.split("/").reverse().slice(2).reverse().join("/")+"/",i=c();return t.length<2&&i!=0&&(v(t)&&(t+="/"),t=t.replace(/\/\//g,"/")),t},fr=function(n){return n.substring(0,n.slice(0,-1).lastIndexOf("/"))+"/"},eu=function(i){return n.inArray(e(i),t.edit.editExt)!=-1?!0:!1},er=function(i){return n.inArray(e(i),t.images.imagesExt)!=-1?!0:!1},ou=function(i){return n.inArray(e(i),t.videos.videosExt)!=-1?!0:!1},su=function(i){return n.inArray(e(i),t.audios.audiosExt)!=-1?!0:!1},hu=function(i){return n.inArray(e(i),t.pdfs.pdfsExt)!=-1?!0:!1},cu=function(i){return n.inArray(e(i),t.docs.docsExt)!=-1?!0:!1},k=function(t,i){if(i=i||!1,t.substr(0,4)==="http"||t.substr(0,3)==="ftp"||t.indexOf(ki)!==-1)return t;if(t=rr(tu(t)),i){var r=[];n.each(t.split("/"),function(n,t){r.push(encodeURIComponent(t))});t=r.join("/")}return p+t},lu=function(n){var i=k(n.videourl,!0),u='<video src="'+i+'" width='+t.videos.videosPlayerWidth+" height="+t.videos.videosPlayerHeight+' controls="controls"><\/video>';r.find("img").remove();r.find("#preview #main-title").before(u)},au=function(n){var t=k(n.Preview,!0),i='<audio src="'+t+'" controls="controls"><\/audio>';r.find("img").remove();r.find("#preview #main-title").before(i)},vu=function(n){var i=k(n.Preview,!0),u='<iframe id="fm-pdf-viewer" src="'+t.globals.pluginPath+"/scripts/ViewerJS/index.html#"+i+'" width="'+t.pdfs.pdfsReaderWidth+'" height="'+t.pdfs.pdfsReaderHeight+'" allowfullscreen webkitallowfullscreen><\/iframe>';r.find("img").remove();r.find("#preview #main-title").before(u)},yu=function(n){var i=encodeURIComponent(k(n.Preview)),u='<iframe id="fm-google-viewer" src="http://docs.google.com/viewer?url='+i+'&embedded=true" width="'+t.docs.docsReaderWidth+'" height="'+t.docs.docsReaderHeight+'" allowfullscreen webkitallowfullscreen><\/iframe>';r.find("img").remove();r.find("#preview #main-title").before(u)},pu=function(t){r.find("tr.file, tr.directory").each(function(){var r=n(this).attr("data-path"),i=u.find('a[data-path="'+r+'"]').parent();typeof i.css("background-image")!="undefined"&&(n(this).find("td:first").css("background-image",i.css("background-image")),window.clearInterval(t))})},ri=function(t){at(t);n("#newfolder").unbind().click(function(){var t=i.default_foldername,u=i.prompt_foldername+' : <input id="fname" name="fname" type="text" value="'+t+'" />',e=function(r,u,e){var s,h;u&&(s=e.children("#fname").val(),s!=""?(t=ii(s),h=c(),n.getJSON(f+"?mode=addfolder&path="+o()+"&config="+userconfig+"&name="+encodeURIComponent(t)+(h!=0?"&folder="+h:"")+"&time="+(new Date).getTime(),function(t){t.Code==0?(bu(t.Parent),l(t.Parent)):n.prompt(t.Error)})):n.prompt(i.no_foldername))},r={};r[i.create_folder]=!0;r[i.cancel]=!1;n.prompt(u,{submit:e,buttons:r,loaded:function(){n(this).find("#fname").focus()}})})},or=function(t){r.find("button").each(function(){n(this).find("span").length==0&&n(this).wrapInner("<span><\/span>")});a(t,"select")?(r.find("button#select").click(function(){rt(t)}).show(),(window.opener||window.tinyMCEPopup)&&n("#preview").find("img").attr("title",i.select).css("cursor","pointer").click(function(){rt(t)})):r.find("button#select").hide();a(t,"rename")?r.find("button#rename").click(function(){sr(t)}).show():r.find("button#rename").hide();a(t,"move")?r.find("button#move").click(function(){cr(t)}).show():r.find("button#move").hide();a(t,"replace")?r.find("button#replace").click(function(){hr(t)}).show():r.find("button#replace").hide();a(t,"delete")?r.find("button#delete").click(function(){lr(t)}).show():r.find("button#delete").hide();a(t,"download")?r.find("button#download").click(function(){ar(t)}).show():r.find("button#download").hide();r.find("#parentfolder").click(function(){l(o())})},o=function(){return n("#currentpath").val()},at=function(t){n("#currentpath").val(t);gt.find("h1").text(i.current_folder+ir(t)).attr("title",ir(t,!1))},d=function(n){return n.find(".mCSB_container").length>0?n.find(".mCSB_container"):n},ui=function(n){return r.data("view")=="grid"?r.find('li[data-path="'+n+'"]'):r.find('tr[data-path="'+n+'"]')},vt=function(){var e=r.data("view")=="grid",t=e?"li":"tbody > tr",u,f=0;u=r.find(t+".file, "+t+".directory").not(".ui-draggable-dragging").length;r.find(t+".file").not(".ui-draggable-dragging").each(function(){var t=n(this).data("itemdata");t&&(f+=Number(t.Properties.Size))});n("#items-counter").text(u+" "+i.items);n("#items-size").text(i.size+": "+b(f))},yt=function(r){t.options.searchBox==!0&&(n("#q").liveUpdate("#filetree ul").blur(),n("#search span.q-inactive").html(i.search),n("#search a.q-reset").attr("title",i.search_reset));r.find("li.file, li.directory").draggable({distance:10,cursor:"move",helper:function(){var t=n(this).clone();return t.find("ul").remove(),t}});r.find("li.directory > a").droppable({accept:function(t){return t.is("li.file, li.directory")&&!t.parent().prev("a").is(n(this))},hoverClass:"drop-hover",drop:function(t,i){var r=i.draggable.find("a").attr("data-path"),u=n(t.target).attr("data-path");pt(r,u)}})},fi=function(){var t=d(u),f=!1,i,r;t.data("fileTree")&&(f=!0,t.unbind().data("fileTree",null).children("ul.jqueryFileTree").remove());i=function(n,t){f||(n.expandSpeed=t?300:0,n.collapseSpeed=t?300:0)};r=function(t,r){if(nt!==null){var u=!1;t.find("li.directory.collapsed").each(function(t,f){var e=n(f).children();nt.indexOf(e.attr("data-path"))===0&&(u=!0,i(r.options,!1),setTimeout(function(){e.click()},50))});u===!1&&(nt=null,i(r.options,!0))}};t.on("filetreeinitiated",function(t,i){var u=n(t.target).find("ul");r(u,i)}).on("filetreeexpand",function(n,t){t.rel&&l(t.rel)}).on("filetreeexpanded",function(n,t){var u=t.li.children("ul");r(u,t);nt==t.rel&&(nt=null,i(t.options,!0))}).fileTree({root:s,script:function(t,i){pi(t,"",function(t){typeof t!="undefined"&&(n("#ultree").length===0&&n(t).attr("id","ultree"),i(t))})},multiFolder:!0,expandSpeed:300,collapseSpeed:300,errorMessage:null},function(n){vi(n)});t.contextMenu({selector:"li a",build:function(n){return{appendTo:".fm-container",items:li(n),callback:function(n,t){var i=t.$trigger.attr("data-path");ai(n,i)}}}})},rt=function(data){var url=k(data.videourl||data.Preview||data.Thumbnail),win,elementId,instance;if(n.urlParam("selectFun")){eval("parent.window."+n.urlParam("selectFun"))(n.urlParam("field_name"),url);typeof parent.$.fn.lightbox!="undefined"&&parent.$.lightbox().close();return}if(window.opener||window.tinyMCEPopup||n.urlParam("field_name")||n.urlParam("CKEditorCleanUpFuncNum")||n.urlParam("CKEditor")||n.urlParam("ImperaviElementId")){if(window.tinyMCEPopup){win=tinyMCEPopup.getWindowArg("window");win.document.getElementById(tinyMCEPopup.getWindowArg("input")).value=url;typeof win.ImageDialog!="undefined"&&(win.ImageDialog.getImageData&&win.ImageDialog.getImageData(),win.ImageDialog.showPreviewImage&&win.ImageDialog.showPreviewImage(url));tinyMCEPopup.close();return}if(n.urlParam("field_name"))parent.document.getElementById(n.urlParam("field_name")).value=url,typeof parent.tinyMCE!="undefined"&&parent.tinyMCE.activeEditor.windowManager.close(),typeof parent.$.fn.colorbox!="undefined"&&parent.$.fn.colorbox.close(),typeof parent.$.fn.lightbox!="undefined"&&parent.$.lightbox().close();else if(n.urlParam("ImperaviElementId"))window.opener||(elementId=n.urlParam("ImperaviElementId"),instance=parent.$("#"+elementId).redactor("core.getObject"),instance&&(instance.modal.close(),instance.buffer.set(),er(data.Filename)?instance.insert.html('<img src="'+url+'">'):instance.insert.html('<a href="'+url+'">'+data.Filename+"<\/a>")));else if(n.urlParam("CKEditor"))window.opener?window.opener.CKEDITOR.tools.callFunction(n.urlParam("CKEditorFuncNum"),url):(parent.CKEDITOR.tools.callFunction(n.urlParam("CKEditorFuncNum"),url),parent.CKEDITOR.tools.callFunction(n.urlParam("CKEditorCleanUpFuncNum")));else if(data.Properties.Width!=""){var p=url,w=data.Properties.Width,h=data.Properties.Height;window.opener.SetUrl(p,w,h)}else window.opener.SetUrl(url);window.opener&&window.close()}else n.prompt(i.fck_select_integration)},sr=function(u){var h=t.security.allowChangeExtensions?u.Filename:fu(u.Filename),l=i.new_filename+' : <input id="rname" name="rname" type="text" value="'+h+'" />',a=function(s,h,l){var y,a,w,p,b,k;if(h&&(y=l.children("#rname").val(),y!="")){if(a=y,t.security.allowChangeExtensions||(a=ru(y),w=e(u.Filename),w.length>0&&(a=a+"."+w)),v(u.Path)&&!uu(a))return p="<p>"+i.INVALID_FILE_TYPE+"<\/p>",t.security.uploadPolicy=="DISALLOW_ALL"&&(p+="<p>"+i.ALLOWED_FILE_TYPE+t.security.uploadRestrictions.join(", ")+".<\/p>"),t.security.uploadPolicy=="ALLOW_ALL"&&(p+="<p>"+i.DISALLOWED_FILE_TYPE+t.security.uploadRestrictions.join(", ")+".<\/p>"),n("#filepath").val(""),n.prompt(p),!1;b=c();k=f+"?mode=rename&old="+encodeURIComponent(u.Path)+"&new="+encodeURIComponent(a)+"&config="+userconfig+(b!=0?"&folder="+b:"");n.ajax({type:"GET",url:k,dataType:"json",async:!1,success:function(u){var b,k,a,d;if(u.Code==0){var f=u["New Path"],c=u["New Name"],s=u["Old Path"],l=tt(f),y=tt(s),p=o(),w=r.find("#main-title > h1"),h=w.length>0;ku(s,f,c);l.indexOf(p)===0?v(f)&&e(f)!==e(s)?(b=h?f:l,g(b)):h&&s===w.attr("title")?ei(f):h||oi(ui(s),f,c):p.indexOf(y)===0?(k=new RegExp("^"+y),a=o().replace(k,l),at(a),h?ei(a):(d=r.data("view")=="grid"?"li":"tbody > tr",wt(s,f,r.find(d)))):oi(ui(s),f,c);bt();vt();t.options.showConfirmation&&n.prompt(i.successful_rename)}else n.prompt(u.Error)},error:it})}},s={};s[i.rename]=!0;s[i.cancel]=!1;n.prompt(l,{submit:a,buttons:s,loaded:function(){n(this).find("#rname").focus()}})},hr=function(s){var c=n("#toolbar"),l=c.find("#replacement");if(typeof c.data("blueimpFileupload")=="undefined")c.fileupload({autoUpload:!0,dataType:"json",url:f+"?config="+userconfig,paramName:t.upload.paramName}).on("fileuploadadd",function(t,r){var u=r.files[0];if(e(u.name)!=s["File Type"])return n.prompt(i.ERROR_REPLACING_FILE+" ."+s["File Type"]),!1;r.submit()}).on("fileuploadsubmit",function(n,t){t.formData={mode:"replace",newfilepath:s.Path};h.addClass("loading").prop("disabled",!0);h.children("span").text(i.loading_data)}).on("fileuploadalways",function(f,e){var c,s,l,a;h.removeData().removeClass("loading").prop("disabled",!1);h.children("span").text(i.upload);s=e.result;s.files&&s.files[0].error&&(c=s.files[0].error);s.Code=="-1"&&s.Error&&(c=s.Error);c?n.prompt(i.upload_failed+"<br>"+c):(l=r.find("#main-title > h1").attr("title"),a=o(),vi(l+"?ran="+Math.floor(Math.random()*100)),ut(a),n("#preview").find("img").hide().fadeIn("slow"),u.find('a[data-path="'+l+'"]').parent().hide().fadeIn("slow"),t.options.showConfirmation&&n.prompt(i.successful_replace))}).on("fileuploadfail",function(){n.prompt(i.upload_failed)});l.click()},cr=function(t){var u=i.move+' : <input id="rname" name="rname" type="text" value="" />',f,r;u+='<div class="prompt-info">'+i.help_move+"<\/div>";f=function(n,i,r){if(i){var u=r.children("#rname").val();u!=""&&pt(t.Path,u)}};r={};r[i.move]=!0;r[i.cancel]=!1;n.prompt(u,{submit:f,buttons:r,loaded:function(){n(this).find("#rname").focus()}})},pt=function(u,e){var s=c(),h=f+"?mode=move&old="+encodeURIComponent(u)+"&new="+encodeURIComponent(e)+"&config="+userconfig+(s!=0?"&folder="+s:"");n.ajax({type:"GET",url:h,dataType:"json",async:!1,success:function(f){var s,a;if(f.Code==0){var e=f["New Path"],c=f["New Name"],h=o();du(e,c,u);h===e&&l(e);h===tt(u)&&(s=v(u)?e:e+c+"/",h===u&&at(s),n("#preview").length>0?ei(s):(a=r.data("view")=="grid"?"li":"tbody > tr",wt(u,s,r.find(a))),bt(),vt());t.options.showConfirmation&&n.prompt(i.successful_moved)}else n.prompt(f.Error)},error:it})},lr=function(u){var e=!1,h=i.confirmation_delete,l=function(s,h){if(h){var l=c(),a=f+"?mode=delete&path="+encodeURIComponent(u.Path)+"&config="+userconfig+"&time="+(new Date).getTime()+(l!=0?"&folder="+l:"");n.ajax({type:"GET",url:a,dataType:"json",async:!1,success:function(u){var s;if(u.Code==0){var f=u.Path,h=r.find("#main-title > h1"),c=h.length>0;pr(f);e=!0;f===o()?(s=fr(f),at(s),g(s)):v(f)&&c&&f===h.attr("title")&&g(tt(f));t.options.showConfirmation&&n.prompt(i.successful_delete)}else e=!1,n.prompt(u.Error)},error:it})}},s={};return s[i.yes]=!0,s[i.no]=!1,n.prompt(h,{submit:l,buttons:s}),e},ar=function(t){var i=c(),r=f+"?mode=download&path="+encodeURIComponent(t.Path)+"&config="+userconfig+(i!=0?"&folder="+i:"");n.ajax({type:"GET",url:r+"&time="+(new Date).getTime(),dataType:"json",async:!1,success:function(t){t.Code==0?window.location=r+"&force=true&time="+(new Date).getTime():n.prompt(t.Error)},error:it})},wu=function(u){var o=!1;return r.find("div#tools").append(' <a id="edit-file" href="#" title="'+i.edit+'"><span>'+i.edit+"<\/span><\/a>"),n("#edit-file").click(function(){n(this).hide();var s=f+"?mode=editfile&path="+encodeURIComponent(u.Path)+"&config="+userconfig+"&time="+(new Date).getTime();n.ajax({type:"GET",url:s,dataType:"json",async:!1,success:function(s){if(s.Code==0){var c=n("#preview"),l,h='<form id="edit-form">';h+='<textarea id="edit-content" name="content">'+s.Content+"<\/textarea>";h+='<input type="hidden" name="mode" value="savefile" />';h+='<input type="hidden" name="path" value="'+u.Path+'" />';h+='<button id="edit-cancel" class="edition" type="button">'+i.quit_editor+"<\/button>";h+='<button id="edit-save" class="edition" type="button">'+i.save+"<\/button>";h+="<\/form>";c.find("img").hide();c.prepend(h).hide().fadeIn();tr(r);n("#edit-cancel").click(function(){c.find("form#edit-form").hide();c.find("img").fadeIn();n("#edit-file").show()});n("#edit-save").click(function(){var r=l.getValue(),t;n("textarea#edit-content").val(r);t=n("#edit-form").serializeArray();n.ajax({type:"POST",url:f+"?config="+userconfig,dataType:"json",data:t,async:!1,success:function(t){t.Code==0?(o=!0,n.prompt(i.successful_edit)):(o=!1,n.prompt(t.Error))},error:it})});l=instantiateCodeMirror(e(u.Path),t,w)}else o=!1,n.prompt(s.Error),n(this).show()}})}),o},vr=function(t,i){i=i||0;ui(t).not(".directory-parent").fadeOut(i,function(){n(this).remove();vt()})},yr=function(t,i){i=i||0;u.find('a[data-path="'+t+'"]').parent().fadeOut(i,function(){n(this).remove()})},bu=function(r){ut(r);t.options.showConfirmation&&n.prompt(i.successful_added_folder)},ff=function(r){ut(r);t.options.showConfirmation&&n.prompt(i.successful_added_file)},ku=function(n,t,i){var r=u.find('a[data-path="'+n+'"]');v(t)?e(t)!==e(n)?gu(tt(t),n,t):si(r,t,i):(si(r,t,i),wt(n,t,r.next("ul").find("a")));ot(u.find('a[data-path="'+t+'"]').parent().parent())},du=function(n,t,i,r){var e;r=r||!1;var h=o(),c=u.find('a[data-path="'+n+'"]'),f=c.next("ul"),a=f.parent();if(vr(i),r&&(nt=n,fi()),n===s&&(f=d(u).children("ul"),a=u),f.length===0){h===i&&(d(u).data("fileTree").options.expandSpeed=0,c.click());yr(i);return}h===n&&(f.is(":hidden")&&f.show().parent().addClass("expanded").removeClass("collapsed"),l(n));e=u.find('a[data-path="'+i+'"]').parent().not(".ui-draggable-dragging");wt(fr(i),n,e.find("a"));e.appendTo(f);ot(f);yt(a)},pr=function(n){vr(n);yr(n)},ei=function(t){var f=n("#toolbar"),e=r.find("#main-title > h1"),u=ur(t)||e.text(),o=tt(t)+u,i;e.text(u).attr("title",o);i=f.data("fmitem");i.Path=o;i.Filename=u;f.find("button").unbind();or(i)},oi=function(n,t,i){var u=n.data("itemdata");u.Path=t;typeof i!="undefined"&&(u.Filename=i,v(i)&&(u["File Type"]=e(i)));n.attr("data-path",t);r.data("view")=="grid"?(n.find("img").attr("alt",t),n.children("p").text(u.Filename)):n.find("td:first").text(u.Filename)},si=function(n,t,i){var r=n.data("itemdata");r.Path=t;typeof i!="undefined"&&(r.Filename=i,v(i)&&(r["File Type"]=e(i)));n.attr("data-path",t).attr("rel",t);n.text(r.Filename)},wt=function(t,i,r){var u=String(t).replace(/[\\^$*+?.()|[\]{}]/g,"\\$&"),f=new RegExp("(^"+u+"\\b)|("+("\\b"+u+"\\b")+")");r.each(function(){var r=n(this).attr("data-path"),t=r.replace(f,i);n(this).is("a")?si(n(this),t):n(this).hasClass("directory-parent")?n(this).attr("data-path",lt(o())):oi(n(this),t)})},hi=function(t){var f=di,i=n(t).data("itemdata"),u;r.data("view")=="list"&&(u=r.data("list-sort"),u&&(f=u.column));switch(f){case"type":return i["File Type"];case"size":return i.Properties.Size;case"modified":return i.Properties.filemtime;case"dimensions":return i.Properties.Width+"x"+i.Properties.Height;default:return i.Filename}},ci=function(n,i){t.options.folderPosition==="bottom"&&n.find(i+".directory").appendTo(n);t.options.folderPosition==="top"&&(n.find(i+".directory").prependTo(n),n.find(i+".directory-parent").prependTo(n))},ot=function(n){var t=n.find("> li");t.length!==0&&(t.tsort({selector:"a",callback:hi,order:dt,natural:!0}),ci(n,"> li"))},bt=function(){var n,t=r.find("#contents"),i,u,e,f,o;if(r.data("view")=="grid"){if(n=t.find("li.file, li.directory"),n.length===0)return;n.tsort({callback:hi,order:dt,natural:!0});ci(t,"li")}else{if(i=r.data("list-sort"),u=t.find("th"),f=i?i.order:dt,e=i?i.column:di,o=u.filter(".column-"+e),u.removeClass("sorted sorted-asc sorted-desc"),o.addClass("sorted sorted-"+f),n=t.find("tr.file, tr.directory"),n.length===0)return;n.tsort({callback:hi,order:f,natural:!0});ci(t,"tr")}},gu=function(n,t,i){var r=u.find('a[data-path="'+t+'"]').parent();pi({dir:tt(n)},i,function(n){r.replaceWith(n)})},ut=function(t){var i,r=t===s;i=r?d(u).children("ul"):u.find('a[data-path="'+t+'"]').next("ul");r||i.parent().hasClass("expanded")?pi({dir:t},"",function(t){var r=i.find(">li>a").map(function(){return this.getAttribute("data-path")}).get();t.find(">li>a").each(function(){r.indexOf(n(this).attr("data-path"))===-1&&i.append(n(this).parent())});ot(i);yt(i)}):(d(u).data("fileTree").options.expandSpeed=0,i.prev("a").click())},g=function(n,t,i){v(n)?vi(n,t):l(n,function(){var i=u.find('a[data-path="'+n+'"]');i.parent().hasClass("collapsed")?i.click():typeof t=="function"&&t()},1,i)};var nf=function(t){var i=c(),r=new Date;n.getJSON(f+"?mode=getinfo&path="+t+"&time="+r.getMilliseconds()+(i!=0?"&folder="+i:""),function(n){rt(n)})},ai=function(t,i){var r=c();n.getJSON(f+"?mode=getinfo&path="+encodeURIComponent(i)+"&config="+userconfig+(r!=0?"&folder="+r:"")+"&time="+(new Date).getTime(),function(i){if(i.Code==0)switch(t){case"select":rt(i);break;case"download":ar(i);break;case"rename":sr(i);break;case"replace":hr(i);break;case"move":cr(i);break;case"delete":lr(i)}else n.prompt(i.Error)})},vi=function(u){var o,e;n(".context-menu-root").hide();o=u.substr(0,u.lastIndexOf("/")+1);ri(o);e=c();n.getJSON(f+"?mode=getinfo&path="+encodeURIComponent(u)+"&config="+userconfig+(e!=0?"&folder="+e:"")+"&time="+(new Date).getTime(),function(f){var o,h,l,a,c,s;if(f.Code=="-1"){ct(f.Error);return}if(o="",o+='<form id="toolbar">',o+='<button id="parentfolder" type="button">'+i.parentfolder+"<\/button>",n.inArray("select",y)!=-1&&(n.urlParam("CKEditor")||window.opener||window.tinyMCEPopup||n.urlParam("field_name")||n.urlParam("ImperaviElementId"))&&(o+='<button id="select" name="select" type="button">'+i.select+"<\/button>"),n.inArray("download",y)!=-1&&(o+='<button id="download" name="download" type="button">'+i.download+"<\/button>"),n.inArray("rename",y)!=-1&&t.options.browseOnly!=!0&&(o+='<button id="rename" name="rename" type="button">'+i.rename+"<\/button>"),n.inArray("move",y)!=-1&&t.options.browseOnly!=!0&&(o+='<button id="move" name="move" type="button">'+i.move+"<\/button>"),n.inArray("delete",y)!=-1&&t.options.browseOnly!=!0&&(o+='<button id="delete" name="delete" type="button">'+i.del+"<\/button>"),n.inArray("replace",y)!=-1&&t.options.browseOnly!=!0&&(o+='<button id="replace" name="replace" type="button">'+i.replace+"<\/button>",o+='<div class="hidden-file-input"><input id="replacement" name="replacement" type="file" /><\/div>'),o+="<\/form>",o+='<div id="preview"><img /><div id="main-title"><h1><\/h1><div id="tools"><\/div><\/div><dl><\/dl><\/div>',d(r).html(o),h=f.Preview||f.Thumbnail,l=u.indexOf("?ran=")>=0,l===!0&&(h+="?ran="+Math.floor(Math.random()*100)),r.find("img").attr("src",k(h)),r.find("#main-title > h1").text(f.Filename).attr("title",u),ou(f.Filename)&&t.videos.showVideoPlayer==!0&&lu(f),su(f.Filename)&&t.audios.showAudioPlayer==!0&&au(f),hu(f.Filename)&&t.pdfs.showPdfReader==!0&&vu(f),cu(f.Filename)&&t.docs.showGoogleViewer==!0&&yu(f),eu(f.Filename)&&t.edit.enabled==!0&&f.Protected==0?wu(f):er(f.Filename)&&t.images.allowEdit===!0&&f.Protected==0&&(r.find("div#tools").append(' <a id="edit-file" href="#" title="'+i.edit+'"><span>'+i.edit+"<\/span><\/a>"),n("#edit-file").click(function(){return tf(encodeURIComponent(f.Path+(e!=0?"&folder="+e:"")),r),!1})),a=k(f.Preview||f.Thumbnail),f.Protected==0){r.find("div#tools").append(' <a id="copy-button" data-clipboard-text="'+a+'" title="'+i.copy_to_clipboard+'" href="#"><span>'+i.copy_to_clipboard+"<\/span><\/a>");ZeroClipboard.config({swfPath:t.globals.pluginPath+"/scripts/zeroclipboard/dist/ZeroClipboard.swf"});c=new ZeroClipboard(document.getElementById("copy-button"));c.on("ready",function(){c.on("aftercopy",function(){})});n("#copy-button").click(function(){r.find("div#tools").append('<span id="copied">'+i.copied+"<\/span>");n("#copied").delay(500).fadeOut(1e3,function(){n(this).remove()})})}s="";f.Protected==0&&(f.Properties.Width&&f.Properties.Width!=""&&(s+="<dt>"+i.dimensions+"<\/dt><dd>"+f.Properties.Width+"x"+f.Properties.Height+"<\/dd>"),f.Properties["Date Created"]&&f.Properties["Date Created"]!=""&&(s+="<dt>"+i.created+"<\/dt><dd>"+f.Properties["Date Created"]+"<\/dd>"),f.Properties["Date Modified"]&&f.Properties["Date Modified"]!=""&&(s+="<dt>"+i.modified+"<\/dt><dd>"+f.Properties["Date Modified"]+"<\/dd>"),(f.Properties.Size||parseInt(f.Properties.Size)==0)&&(s+="<dt>"+i.size+"<\/dt><dd>"+b(f.Properties.Size)+"<\/dd>"));r.find("dl").html(s);n("#toolbar").data("fmitem",f);or(f)})},yi=function(t){var i=n.extend({},t);return delete i.Thumbnail,delete i.Error,delete i.Code,i},l=function(u,f,e,o){ri(u);var h=d(r),c='<img id="activity" src="'+t.globals.pluginPath+"/themes/"+t.options.theme+'/images/wait30trans.gif" width="30" height="30" />';h.html(c);n("#loading-wrap").fadeOut(800);wr(u,function(e){var ii=d(r),c,y,p,h,ft="",ut,et,at,wt,ri,tt,nt,st,ui,fi,it,kt,dt,gt,ni,w,ei,ti;if(e.Code=="-1"){ct(e.Error);return}if(ht(),ut="",e){if(r.data("view")=="grid"){et=n("<ul>",{id:"contents","class":"grid"});v(u)||u===s||(p='<li class="directory-parent" data-path="'+lt(u)+'" oncontextmenu="return false;">',p+='<div class="clip"><img src="'+t.globals.pluginPath+"/"+t.icons.path+'_Parent.png" alt="Parent" /><\/div>',p+="<\/li>",et.append(p));for(st in e){if(c=e[st],typeof c.Paging!="undefined"){ut=c.Paging;continue}h=c.Properties;at=64;wt=h.Width;wt>1&&wt<at&&(at=wt);ri=n("<li>",{"class":c["File Type"]=="dir"?"directory":"file",title:t.options.showTitleAttr?c.Path:null,"data-path":c.Path}).data("itemdata",yi(c));y='<div class="clip"><img src="'+k(c.Preview||c.Thumbnail)+'" width="'+at+'" alt="'+c.Path+'" /><\/div>';y+="<p>"+c.Filename+"<\/p>";h.Width&&h.Width!=""&&(y+='<span class="meta dimensions">'+h.Width+"x"+h.Height+"<\/span>");h.Size&&h.Size!=""&&(y+='<span class="meta size">'+h.Size+"<\/span>");h["Date Created"]&&h["Date Created"]!=""&&(y+='<span class="meta created">'+h["Date Created"]+"<\/span>");h["Date Modified"]&&h["Date Modified"]!=""&&(y+='<span class="meta modified">'+h["Date Modified"]+"<\/span>");et.append(ri.append(y))}ft=et}else{tt=n("<table>",{id:"contents","class":"list"});nt='<thead><tr class="rowHeader">';nt+='<th class="column-name" data-colname="name"><span>'+i.name+"<\/span><\/th>";nt+='<th class="column-type" data-colname="type"><span>'+i.type+"<\/span><\/th>";nt+='<th class="column-dimensions" data-colname="dimensions"><span>'+i.dimensions+"<\/span><\/th>";nt+='<th class="column-size" data-colname="size"><span>'+i.size+"<\/span><\/th>";nt+='<th class="column-modified" data-colname="modified"><span>'+i.modified+"<\/span><\/th>";nt+="<\/tr><\/thead>";tt.append(nt);tt.append("<tbody>");v(u)||u===s||(p='<tr class="directory-parent" data-path="'+lt(u)+'" oncontextmenu="return false;">',p+="<td>..<\/td>",p+="<td><\/td>",p+="<td><\/td>",p+="<td><\/td>",p+="<td><\/td>",p+="<\/tr>",tt.append(p));for(st in e){if(c=e[st],typeof c.Paging!="undefined"){ut=c.Paging;continue}h=c.Properties;ui=n("<tr>",{"class":c["File Type"]=="dir"?"directory":"file",title:t.options.showTitleAttr?c.Path:null,"data-path":c.Path}).data("itemdata",yi(c));y="<td>"+c.Filename+"<\/td>";y+=c["File Type"]&&c["File Type"]!=""&&c["File Type"]!="dir"?"<td>"+c["File Type"]+"<\/td>":"<td><\/td>";h.Width&&h.Width!=""?(fi=h.Width+"x"+h.Height,y+="<td>"+fi+"<\/td>"):y+="<td><\/td>";y+=h.Size&&h.Size!=""?"<td>"+b(h.Size)+"<\/td>":"<td><\/td>";y+=h["Date Modified"]&&h["Date Modified"]!=""?"<td>"+h["Date Modified"]+"<\/td>":"<td><\/td>";tt.append(ui.append(y))}tt.append("<\/tbody>");ft=tt}if(o===!0){it=[];kt=n('#filetree ul li a[data-path="'+u+'"]');it=kt.length>0?kt.parent().children("ul"):n("#filetree ul#ultree");it.children("li.file").remove();dt=[];for(gt in e)e[gt]["File Type"]!=="dir"&&(ni=br(e[gt]),ni!==null&&dt.push(ni));it.append(dt);ot(it);yt(it)}}else ft+="<h1>"+i.could_not_retrieve_folder+"<\/h1>";ii.html(ft);ut.length>0&&ii.append(ut);bt();vt();w=r.find("#contents");r.data("view")=="grid"?(w.contextMenu({selector:"li.file, li.directory",build:function(n){return{appendTo:".fm-container",items:li(n),callback:function(n,t){var i=t.$trigger.attr("data-path");ai(n,i)}}}}),w.find("li.file, li.directory").draggable({distance:10,cursor:"move",helper:"clone"}),w.find("li.directory-parent, li.directory").droppable({accept:"li.file, li.directory",hoverClass:"drop-hover",drop:function(t,i){var r=i.draggable.attr("data-path"),u=n(t.target).attr("data-path");pt(r,u)}}),w.find("li").each(function(){var t=n(this).attr("data-path");n(this).find(".meta.size").length>0?n(this).single_double_click(function(){g(t)},function(){var i=n(this).data("itemdata");i?rt(i):nf(t)}):n(this).click(function(){g(t,undefined,!0)})})):(w.contextMenu({selector:"tr.file, tr.directory",build:function(n){return{appendTo:".fm-container",items:li(n),callback:function(n,t){var i=t.$trigger.attr("data-path");ai(n,i)}}}}),w.find("tr.file, tr.directory").draggable({distance:10,cursor:"move",helper:"clone"}),w.find("tr.directory-parent, tr.directory").droppable({accept:"tr.file, tr.directory",hoverClass:"drop-hover",drop:function(t,i){var r=i.draggable.attr("data-path"),u=n(t.target).attr("data-path");pt(r,u)}}),w.find("tbody > tr").click(function(){var i=n(this).attr("data-path");t.options.quickSelect&&e[i]["File Type"]!="dir"&&a(e[i],"select")?rt(e[i]):g(i)}),w.find(".rowHeader > th").click(function(){var t=n(this),i=t.data("colname"),u=!t.hasClass("sorted-desc"),f=u?"desc":"asc";r.data("list-sort",{column:i,order:f});bt()}),ei=setInterval(function(){pu(ei)},300));ti=r.find(".fm-container .btn-paging");ti.length>0&&ti.click(function(){var t=n(this).children("span:eq(0)").attr("data-indx")||"1";l(u,undefined,t,!0)});tr(r);typeof f=="function"&&f()},e)},wr=function(i,r,u){var e,o;!ft[i]||Date.now()-ft[i].cached>2e3?(e=f+"?mode=getfolder&path="+encodeURIComponent(i)+"&config="+userconfig+"&showThumbs="+t.options.showThumbs+"&time="+(new Date).getTime(),n.urlParam("type")&&(e+="&type="+n.urlParam("type")),o=c(),o!=0&&(e+="&folder="+o),typeof u=="undefined"?n.urlParam("p")&&(e+="&p="+n.urlParam("p")):e+="&p="+u,n.ajax({url:e,dataType:"json",cache:!1,success:function(n){if(n.Code=="-1"){ct(n.Error);return}ft[i]={cached:Date.now(),data:n};typeof r=="function"&&r(ft[i].data)},error:function(n){it(n);typeof r=="function"&&r()}})):typeof r=="function"&&r(ft[i].data)},pi=function(t,r,u){wr(t.dir,function(t){var o,h=[],s,f,e;if(t.Code=="-1"){ct(t.Error);return}if(t){for(s in t)if(f=br(t[s]),f!==null){if(r&&t[s].Path===r)return f;h.push(f)}e=n("<ul>",{"class":"jqueryFileTree",style:"display: none;"}).append(h);ot(e);yt(e);o=e}else o=n("<h1>").text(i.could_not_retrieve_folder);typeof u=="function"&&u(o)})},br=function(i){if(typeof i.Paging!="undefined")return null;var u,r,f=n("<a>",{rel:i.Path,"data-path":i.Path,text:i.Filename}).data("itemdata",yi(i));return i["File Type"]=="dir"?(r=i.Protected==0?"":" directory-locked",u=n("<li>",{"class":"directory collapsed"+r}).append(f)):t.options.listFiles&&(r=i.Protected==0?"":" file-locked",u=n("<li>",{"class":"file ext_"+i["File Type"].toLowerCase()+r}).append(f)),u},tf=function(t){if(t&&t.length>0){var u=kr(),r="image-editor/ImageEditor.aspx?d="+t,i=dr(97,96);n.lightbox(r,{width:i[0]-30,height:i[1]-20,iframe:!0,onOpen:function(){},onClose:function(){var i=n.LightBoxObject.esqueleto.html.find("iframe"),t,r;i.length>0&&(t=i[0].contentWindow.DhTBDScript.Editor,typeof t!="undefined"&&typeof t.Data.sessionFile!="undefined"&&t.Data.sessionFile.length>0&&(t.Data.isSaveAs===!0||(n("#main-title > h1").text(ur(t.Data.sessionFile)),g(t.Data.sessionFile+"?ran="+Math.floor(Math.random()*100))),r=o(),ut(r)))}})}},kr=function(){var n=0,t=0;return window.innerWidth?(n=window.innerWidth,t=window.innerHeight):document.documentElement.clientWidth===0?(n=document.body.clientWidth,t=document.body.clientHeight):(n=document.documentElement.clientWidth,t=document.documentElement.clientHeight),{width:n,height:t}},dr=function(n,t){var i=[],r=kr();return typeof n!="undefined"&&i.push(r.width*n/100),typeof t!="undefined"&&i.push(r.height*t/100),i},rf=function(){var n=0;return function(t,i){clearTimeout(n);n=setTimeout(t,i)}}();n(function(){var a,k,d,tt,it,rt,ft;if(t.extras.extra_js)for(a=0;a<t.extras.extra_js.length;a++)n.ajax({url:t.extras.extra_js[a],dataType:"script",async:t.extras.extra_js_async});if(n("div.version").html(t.version),n.ajax({url:t.globals.pluginPath+"/themes/"+t.options.theme+"/styles/ie.css",async:!1,success:function(t){n("head").append(t)}}),w("/scripts/zeroclipboard/dist/ZeroClipboard.js"),t.edit.enabled&&(et("/scripts/codemirror-5.17.0/lib/codemirror.css"),et("/scripts/codemirror-5.17.0/theme/"+t.edit.theme+".css"),w("/scripts/codemirror-5.17.0/lib/codemirror.js"),w("/scripts/codemirror-5.17.0/addon/selection/active-line.js"),et("/scripts/codemirror-5.17.0/addon/display/fullscreen.css"),w("/scripts/codemirror-5.17.0/addon/display/fullscreen.js"),w("/scripts/codemirror-5.17.0/dynamic-mode.js")),p=t.options.baseUrl===!1?location.origin+location.pathname:t.options.baseUrl,e(p).length>0&&(p=p.substring(0,p.lastIndexOf("/")+1)),p=rr(p)+"/",k=c(),k!=0&&(v(s)&&(s+="/"),s=s.replace(/\/\//g,"/")),d="",k!=0&&(d=k,nt=s+d),t.options.localizeGUI===!0&&(h.append(i.upload),n("#newfolder").append(i.new_folder),n("#grid").attr("title",i.grid_view),n("#list").attr("title",i.list_view)),n.urlParam("CKEditorCleanUpFuncNum")&&(n("body").append('<button id="close-btn" type="button">'+i.close+"<\/button>"),n("#close-btn").click(function(){parent.CKEDITOR.tools.callFunction(n.urlParam("CKEditorCleanUpFuncNum"))})),n("#browse").append("+").attr("title",i.browse),n("#newfile").change(function(){n("#filepath").val(n(this).val().replace(/.+[\\\/]/,""))}),t.options.searchBox===!0?w("/scripts/filemanager.liveSearch.js"):n("#search").remove(),n("button").wrapInner("<span><\/span>"),r.data("view",t.options.defaultViewMode),ti(t.options.defaultViewMode),n("#home").click(function(){l(s,fi)}),n("#level-up").click(function(){var t=o(),i=n("#preview").length>0,r;if(t==s&&!i)return!1;r=i?t:lt(t);l(r)}),n("#grid").click(function(){ti("grid");r.data("view","grid");l(o())}),n("#list").click(function(){ti("list");r.data("view","list");l(o())}),n("#summary").click(function(){var r='<div class="title">'+i.summary_title+"<\/div>",u=n.prompt(r).addClass("summary-popup"),e=o();n.getJSON(f+"?mode=summarize&path="+e+"&config="+userconfig,function(r){var f,e;if(r.Code==0){if(f=u.find(".jqimessage"),e=b(r.Size,!0),t.options.fileRootSizeLimit>0){var o=b(t.options.fileRootSizeLimit,!0),s=r.Size*100/t.options.fileRootSizeLimit,h=Math.round(s*100)/100;e+=" ("+h+"%) "+i.of+" "+o}f.append(n("<div>",{"class":"line",text:i.summary_files+": "+r.Files}));r.Folders&&f.append(n("<div>",{"class":"line",text:i.summary_folders+": "+r.Folders}));f.append(n("<div>",{"class":"line",text:i.summary_size+": "+e}))}else n.prompt(r.Error)})}),ri(s),t.upload.multiple)et("/scripts/jQuery-File-Upload/css/dropzone.css"),n("#file-input-container").remove(),h.unbind().click(function(){var h,a,w,v,k;if(y.indexOf("upload")===-1)return n.prompt(i.NOT_ALLOWED),!1;var e=c(),p,u=o(),g=i.upload_files_number_limit.replace("%s",t.upload.numberOfFiles),d=typeof t.security.uploadRestrictions!="undefined"&&t.security.uploadRestrictions.length<10?"------Allow extension(s): "+t.security.uploadRestrictions.join(", ")+".":"";typeof imageDimessionText!="undefined"&&(h=u,typeof forcePath!="undefined"&&(h=forcePath),a=0,n.each(imageDimessionText,function(n,t){return a=t.p.toLowerCase().lastIndexOf(h.toLowerCase()),a>=0&&a+h.length===t.p.length?(d+="------ ------Image dimension: "+t.info,!1):void 0}));templateContainer=gi("upload-container",{folder:i.current_folder+u,info:g,sizeLimit:i.upload_file_size_limit+b(t.upload.fileSizeLimit,!0),moreInfo:d,lang:i});templateContainer=templateContainer.replace(/------/g,"<br/>");p=t.security.uploadPolicy=="DISALLOW_ALL"?new RegExp("(\\.|\\/)("+t.security.uploadRestrictions.join("|")+")$","i"):null;(n.urlParam("type").toString().toLowerCase()=="images"||t.upload.imagesOnly)&&(p=new RegExp("(\\.|\\/)("+t.images.imagesExt.join("|")+")$","i"));w={};w[i.close]=!1;n.prompt(templateContainer,{buttons:w,persistent:!0});var s=n("#fileupload-container"),r=n(".dropzone",s),nt=n("#total-progress",s).children();r.on("click",function(t){(t.target===this||n(t.target).parent().hasClass("default-message"))&&n("#fileupload",s).trigger("click")});r.on("click",".button-start",function(){var t=n(this),i=t.parent().parent(),r=i.data();r.submit();t.remove()});r.on("click",".button-abort",function(){var u=n(this),f=u.parent().parent(),t=f.data(),r=t.files[0].context;t.abort();r.find(".error-message").text(i.upload_aborted);r.addClass("aborted")});r.on("click",".button-resume",function(t){var h=n(this),c=h.parent().parent(),i=c.data(),r=i.files[0],o,s;r.chunkUploaded&&(o=u+r.serverName,s=f+"?mode=getinfo&path="+encodeURIComponent(o)+"&config="+userconfig+"&time="+(new Date).getTime()+(e!=0?"&folder="+e:""),n.ajax({url:s,dataType:"json",async:!1,success:function(n){n.Code==0&&(i.uploadedBytes=Number(n.Properties.Size),i.uploadedBytes||(r.chunkUploaded=undefined))}}));n.blueimp.fileupload.prototype.options.add.call(n("#fileupload")[0],t,i);i.submit()});r.on("click",".button-remove",function(){var t=n(this),s=t.parent().parent(),h=s.data(),i=h.files[0],r,o;i.chunkUploaded&&(r=u+i.serverName,o=f+"?mode=delete&path="+encodeURIComponent(r)+"&config="+userconfig+"&time="+(new Date).getTime()+(e!=0?"&folder="+e:""),n.getJSON(o,function(n){if(n.Code==0){var t=n.Path;pr(t)}}));t.closest(".upload-item").remove();v()});r.on("click",".button-info",function(){var r=n(this),i=r.closest(".upload-item"),t;i.hasClass("error")&&(t=i.find(".error-message"),t.css({opacity:t.css("opacity")==="1"?"0":"1"}))});n("#process-upload",s).on("click",function(){r.find(".button-start").trigger("click")});v=function(){r.children(".upload-item").length>0?r.addClass("started"):r.removeClass("started")};k={mode:"add",currentpath:u};e!=0&&(k.folder=e);n("#fileupload",s).fileupload({autoUpload:!1,sequentialUploads:!0,dataType:"json",dropZone:r,maxChunkSize:t.upload.chunkSize,url:f+"?config="+userconfig,paramName:t.upload.paramName,formData:k,maxNumberOfFiles:t.upload.numberOfFiles,acceptFileTypes:p,maxFileSize:t.upload.fileSizeLimit,messages:{maxNumberOfFiles:i.upload_files_number_limit.replace("%s",t.upload.numberOfFiles),acceptFileTypes:i.upload_file_type_invalid,maxFileSize:i.upload_file_too_big+" "+i.upload_file_size_limit+b(t.upload.fileSizeLimit,!0)},previewMaxHeight:120,previewMaxWidth:120,previewCrop:!0}).on("fileuploadadd",function(u,f){var e=r.children(".upload-item");n.each(f.files,function(u,o){if(e.length>=t.upload.numberOfFiles)return!1;o.formattedSize=b(o.size);var s=n(gi("upload-item",{file:o,lang:i,imagesPath:t.globals.pluginPath+"/scripts/jQuery-File-Upload/img"}));o.context=s;s.find(".buttons").data(f);s.appendTo(r)});v()}).on("fileuploadsend",function(t,i){n.each(i.files,function(n,t){var r=t.context;r.removeClass("added aborted error").addClass("process");t.chunkUploaded&&i.total===i.uploadedBytes&&r.remove()})}).on("fileuploadfail",function(t,r){n.each(r.files,function(n,t){t.error=i.upload_failed;var r=t.context;r.removeClass("added process").addClass("error")})}).on("fileuploaddone",function(t,i){n.each(i.files,function(n,t){var u,r=i.result,f=t.context;r.files&&r.files[n].error&&(u=r.files[n].error);r.Code=="-1"&&r.Error&&(u=r.Error);u?(f.removeClass("added process").addClass("error"),f.find(".error-message").text(u),f.find(".button-start").remove()):f.remove()})}).on("fileuploadalways",function(){var f=r.children(".upload-item");f.filter(".added").length===0&&f.filter(".process").length===0&&(f.length===0&&(n.prompt.close(),t.options.showConfirmation&&n.prompt(i.upload_successful_files)),f.filter(".error").length&&n.prompt(i.upload_partially+"<br>"+i.upload_failed_details),l(u,function(){ut(u)}));v()}).on("fileuploadprocessalways",function(t,i){n.each(i.files,function(n,t){var i=t.context;i&&(t.preview&&(i.find(".image").append(t.preview),i.find(".preview").removeClass("file-preview").addClass("image-preview")),t.error&&(i.removeClass("added process").addClass("error"),i.find(".error-message").text(t.error),i.find(".button-start").remove()))})}).on("fileuploadprogress",function(t,i){n.each(i.files,function(n,t){var r=t.context,u=parseInt(i.loaded/i.total*100,10);r.find(".progress-bar").css("width",u+"%")})}).on("fileuploadprogressall",function(n,t){var i=parseInt(t.loaded/t.total*100,10);nt.css("width",i+"%")}).on("fileuploadchunkdone",function(t,i){n.each(i.files,function(n,t){t.serverName=i.result.files[n].name;t.chunkUploaded=1})})});else{h.click(function(){if(y.indexOf("upload")===-1)return n.prompt(i.NOT_ALLOWED),!1;var t=n(this).data();n.isEmptyObject(t)?n.prompt(i.upload_choose_file):t.submit()});tt=c();it={mode:"add",currentpath:o()};tt!=0&&(it.folder=tt);gt.fileupload({autoUpload:!1,dataType:"json",url:f+"?config="+userconfig,paramName:t.upload.paramName}).on("fileuploadadd",function(n,t){h.data(t)}).on("fileuploadsubmit",function(n,t){t.formData=it;h.addClass("loading").prop("disabled",!0);h.children("span").text(i.loading_data)}).on("fileuploadalways",function(r,u){var e,f,s;n("#filepath").val("");h.removeData().removeClass("loading").prop("disabled",!1);h.children("span").text(i.upload);f=u.result;f.files&&f.files[0].error&&(e=f.files[0].error);f.Code=="-1"&&f.Error&&(e=f.Error);e?n.prompt(i.upload_failed+"<br>"+e):(s=o(),l(s),ut(s),t.options.showConfirmation&&n.prompt(i.upload_successful_file))}).on("fileuploadfail",function(){n.prompt(i.upload_failed)})}t.customScrollbar.enabled&&(et("/scripts/custom-scrollbar-plugin/jquery.mCustomScrollbar.min.css"),w("/scripts/custom-scrollbar-plugin/jquery.mCustomScrollbar.concat.min.js"),rt=t.customScrollbar.theme!=undefined?t.customScrollbar.theme:"inset-2-dark",ft=t.customScrollbar.button!=undefined?t.customScrollbar.button:!0,n(window).load(function(){u.append('<div style="height:3px"><\/div>');u.mCustomScrollbar({theme:rt,scrollButtons:{enable:ft},advanced:{autoExpandHorizontalScroll:!0,updateOnContentResize:!0},callbacks:{onInit:function(){}},axis:"yx"});r.mCustomScrollbar({theme:rt,scrollButtons:{enable:ft},advanced:{autoExpandHorizontalScroll:!0,updateOnContentResize:!0},axis:"y",alwaysShowScrollbar:1})}));t.options.browseOnly==!0?(n("#file-input-container").remove(),h.remove(),n("#newfolder").remove(),n("#toolbar").remove("#rename")):y.indexOf("move")<0&&y.indexOf("rename")<0&&n("#newfolder").remove();ht();n(window).resize(function(){rf(function(){var t,r,i;ht();t=n.lightbox();typeof t!="undefined"&&t.visible===!0&&(r=n.lightbox().esqueleto.html.find("iframe"),r.length>0&&(i=dr(97,96),t.resize(i[0],i[1])))},500)});n("#splitter").splitter({sizeLeft:t.options.splitterMinWidth,minLeft:t.options.splitterMinWidth,minRight:200});g(s,fi)});gr=document.documentElement;gr.setAttribute("data-useragent",navigator.userAgent);t.options.logger&&(nu=(new Date).getTime(),uf=nu-bi);n(window).load(function(){ht()})})(jQuery);window.location.origin||(window.location.origin=window.location.protocol+"//"+window.location.hostname+(window.location.port?":"+window.location.port:""));$(window).load(function(){$("#fileinfo").css({left:$("#splitter .vsplitbar").width()+$("#filetree").width()})});
/*
//# sourceMappingURL=filemanager.min.js.map
*/